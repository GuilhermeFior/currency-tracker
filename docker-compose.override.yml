services:
  airflow-webserver:
    environment:
      AIRFLOW__CORE__DAGS_FOLDER: /project/dags
      GOOGLE_APPLICATION_CREDENTIALS: /keys/{GCP_KEY_FILENAME}
    volumes:
      - ./../project
      - ${HOST_KEYS_DIR}:/keys:ro
      - ${HOST_DBT_DIR:-~/.dbt}:/home/airflow/.dbt:ro

  airflow-scheduler:
    environment:
      AIRFLOW__CORE__DAGS_FOLDER: /project/dags
      GOOGLE_APPLICATION_CREDENTIALS: /keys/{GCP_KEY_FILENAME}
    volumes:
      - ./../project
      - ${HOST_KEYS_DIR}:/keys:ro
      - ${HOST_DBT_DIR:-~/.dbt}:/home/airflow/.dbt:ro

  airflow-worker:
    environment:
      AIRFLOW__CORE__DAGS_FOLDER: /project/dags
      GOOGLE_APPLICATION_CREDENTIALS: /keys/{GCP_KEY_FILENAME}
    volumes:
      - ./../project
      - ${HOST_KEYS_DIR}:/keys:ro
      - ${HOST_DBT_DIR:-~/.dbt}:/home/airflow/.dbt:ro

  airflow-init:
    environment:
      AIRFLOW__CORE__DAGS_FOLDER: /project/dags
      GOOGLE_APPLICATION_CREDENTIALS: /keys/{GCP_KEY_FILENAME}
      AIRFLOW_UID: ${AIRFLOW_UID}
    volumes:
      - ./../project
      - ${HOST_KEYS_DIR}:/keys:ro
      - ${HOST_DBT_DIR:-~/.dbt}:/home/airflow/.dbt:ro